{% extends 'base.html' %}

{% block title %}Edit Review{% endblock %}

{% block page_header %}
  <h1 class="display-6">Edit Review</h1>
  <p class="lead text-muted">Update your review for "{{ book.title }}"</p>
{% endblock page_header %}

{% block content %}

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <div class="mb-4 p-3 bg-light rounded">
          <h5 class="mb-1">{{ book.title }}</h5>
          <p class="text-muted mb-0">by {{ book.author }}</p>
        </div>

        <form method="post" action="{% url 'read_up:edit_review' review.id %}">
          {% csrf_token %}
          
          <div class="mb-4">
            <label for="{{ form.rating.id_for_label }}" class="form-label fw-bold">
              Rating <span class="text-danger">*</span>
            </label>
            <div class="rating-input">
              {% for choice in form.rating.field.choices %}
                <div class="form-check form-check-inline">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="rating" 
                    id="rating{{ choice.0 }}" 
                    value="{{ choice.0 }}"
                    {% if form.rating.value == choice.0|stringformat:"s" %}checked{% endif %}>
                  <label class="form-check-label d-flex align-items-center" for="rating{{ choice.0 }}">
                    {% for i in "12345" %}
                      {% if forloop.counter <= choice.0 %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#dc143c" viewBox="0 0 16 16">
                          <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                        </svg>
                      {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#dee2e6" viewBox="0 0 16 16">
                          <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                        </svg>
                      {% endif %}
                    {% endfor %}
                  </label>
                </div>
              {% endfor %}
            </div>
            {% if form.rating.errors %}
              <div class="text-danger mt-2">{{ form.rating.errors }}</div>
            {% endif %}
          </div>

          <div class="mb-4">
            <label for="{{ form.review_text.id_for_label }}" class="form-label fw-bold">
              Your Review (Optional)
            </label>
            <textarea 
              class="form-control" 
              id="{{ form.review_text.id_for_label }}" 
              name="review_text" 
              rows="8"
              placeholder="What did you think about this book? Share your thoughts...">{{ form.review_text.value|default:'' }}</textarea>
            {% if form.review_text.errors %}
              <div class="text-danger mt-2">{{ form.review_text.errors }}</div>
            {% endif %}
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
              </svg>
              Update Review
            </button>
            <a href="{% url 'read_up:book' book.id %}" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .rating-input .form-check-input:checked + .form-check-label svg {
    fill: #dc143c !important;
  }
  
  .rating-input .form-check {
    margin-right: 1rem;
  }
</style>

{% endblock %}