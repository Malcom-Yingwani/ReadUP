{% extends 'base.html' %}

{% block title %}Edit Review{% endblock %}

{% block page_header %}
  <h1 class="display-6">Edit Review</h1>
  <p class="lead text-muted">Update your review for "{{ book.title }}"</p>
{% endblock page_header %}

{% block content %}

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <div class="mb-4 p-3 bg-light rounded">
          <h5 class="mb-1">{{ book.title }}</h5>
          <p class="text-muted mb-0">by {{ book.author }}</p>
        </div>

        <form method="post" action="{% url 'read_up:edit_review' review.id %}">
          {% csrf_token %}
          
          <div class="mb-4">
            <label for="{{ form.rating.id_for_label }}" class="form-label fw-bold">
              Rating <span class="text-danger">*</span>
            </label>
            <div class="rating-input input d-flex gap-2">
              {% for choice in form.rating.field.choices %}
                 {% if choice.0 %}
                  <input 
                    class="form-check-input rating-radio" 
                    type="radio" 
                    name="rating" 
                    id="rating{{ choice.0 }}" 
                    value="{{ choice.0 }}"
                    data-rating="{{ choice.0 }}"
                    {% if form.rating.value == choice.0|stringformat:"s" %}checked{% endif %}>
                  <label class="rating-label" for="rating{{ choice.0 }}">
                    <svg class="star-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#dee2e6" viewBox="0 0 16 16">
                      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                    </svg>
                  </label>
                      {% endif %}
                    {% endfor %}
                </div>
                {% if form.rating.errors %}
                  <div class="text-danger mt-2">{{ form.rating.errors }}</div>
               {% endif %}
            </div>

          <div class="mb-4">
            <label for="{{ form.review_text.id_for_label }}" class="form-label fw-bold">
              Your Review (Optional)
            </label>
            <textarea 
              class="form-control" 
              id="{{ form.review_text.id_for_label }}" 
              name="review_text" 
              rows="8"
              placeholder="What did you think about this book? Share your thoughts...">{{ form.review_text.value|default:'' }}</textarea>
            {% if form.review_text.errors %}
              <div class="text-danger mt-2">{{ form.review_text.errors }}</div>
            {% endif %}
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
              </svg>
              Update Review
            </button>
            <a href="{% url 'read_up:book' book.id %}" class="btn btn-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .rating-input {
    position: relative;
  }
  
  .rating-radio {
    display: none;
  }
  
  .rating-label {
    cursor: pointer;
    transition: transform 0.2s;
  }
  
  .rating-label:hover {
    transform: scale(1.1);
  }
  
  .star-icon {
    fill: #dee2e6;
    transition: fill 0.2s;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const radioInputs = document.querySelectorAll('.rating-radio');
    const labels = document.querySelectorAll('.rating-label');
    
    function updateStars() {
      // Reset all stars to gray
      labels.forEach(label => {
        const star = label.querySelector('.star-icon');
        star.style.fill = '#dee2e6';
      });
      
      // Find checked radio
      const checkedRadio = document.querySelector('.rating-radio:checked');
      if (checkedRadio) {
        const rating = parseInt(checkedRadio.dataset.rating);
        
        // Fill only up to the selected rating
        labels.forEach((label, index) => {
          if (index < rating) {
            const star = label.querySelector('.star-icon');
            star.style.fill = '#dc143c';
          }
        });
      }
    }
    
    // Add click handlers
    radioInputs.forEach(radio => {
      radio.addEventListener('change', updateStars);
    });
    
    // Initialize on page load
    updateStars();
  });
</script>
{% endblock %}